{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
  <h2>Vytvoriť faktúru</h2>
  {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                    <div class="alert alert-{{ category }} mt-2">{{ message }}</div>
                    {% endfor %}
                {% endif %}
                {% endwith %}
  <form method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <div class="row mb-3">
      <div class="col-md-4">
        <label>Číslo faktúry</label>
        <input type="text" name="invoice_number" class="form-control" required>
      </div>
      <div class="col-md-4">
        <label>Dátum</label>
        <input type="date" name="date" class="form-control" required>
      </div>
      <div class="col-md-4">
        <label>Splatnosť</label>
        <input type="date" name="due_date" class="form-control" required>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-6">
        <label>Klient</label>
        <select name="client_id" class="form-control" required>
          {% for client in clients %}
          <option value="{{ client.id }}">{{ client.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-6">
        <label>Firma</label>
        <select name="company_id" class="form-control" required>
          {% for company in companies %}
          <option value="{{ company.id }}">{{ company.name }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-6">
        <label>Mena</label>
        <input type="text" name="currency" class="form-control" value="EUR" required>
      </div>
      <div class="col-md-6">
        <label>Sadzba DPH (%)</label>
        <input type="number" step="0.01" name="vat_rate" class="form-control" value="0">
      </div>
    </div>
    <div class="mb-3">
  <label for="payment_method" class="form-label">Spôsob úhrady</label>
  <select id="payment_method" name="payment_method" class="form-select">
    <option value="bank_transfer" selected>Bankový prevod</option>
    <option value="cash">Hotovosť</option>
    <option value="card">Karta</option>
    <option value="other">Iné</option>
  </select>
</div>

    <h4>Položky</h4>
    <table class="table table-bordered" id="items-table">
      <thead>
        <tr>
          <th>Popis</th>
          <th>Množstvo</th>
          <th>Jednotka</th>
          <th>Cena za MJ</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input type="text" name="description[]" class="form-control" required></td>
          <td><input type="number" name="quantity[]" step="0.01" class="form-control" required></td>
          <td><input type="text" name="unit[]" class="form-control" required></td>
          <td><input type="number" name="price_per_item[]" step="0.01" class="form-control" required></td>
          <td><button type="button" class="btn btn-danger btn-sm remove-row">&times;</button></td>
        </tr>
      </tbody>
    </table>
    <button type="button" class="btn btn-secondary mb-3" id="add-row">Pridať položku</button>

    <div>
      <button type="submit" class="btn btn-primary">Uložiť faktúru</button>
    </div>
  </form>
</div>

<script>
  document.getElementById('add-row').addEventListener('click', () => {
    const row = document.querySelector('#items-table tbody tr').cloneNode(true);
    row.querySelectorAll('input').forEach(input => input.value = '');
    document.querySelector('#items-table tbody').appendChild(row);
  });

  document.querySelector('#items-table').addEventListener('click', (e) => {
    if (e.target.classList.contains('remove-row')) {
      const rows = document.querySelectorAll('#items-table tbody tr');
      if (rows.length > 1) {
        e.target.closest('tr').remove();
      }
    }
  });
</script>
{% endblock %}
